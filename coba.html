<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pemutar Video Elegan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #0f0f0f;
      color: #fff;
    }
    h1 {
      color: #00e5ff;
      text-align: center;
      padding: 20px 0 10px;
    }

    .video-container {
      max-width: 900px;
      margin: auto;
      border: 3px solid #00e5ff;
      border-radius: 12px;
      overflow: hidden;
      background: #1e1e1e;
      position: relative;
    }

    video {
      width: 100%;
      display: block;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
      background: rgba(28, 28, 28, 0.9);
      padding: 10px 15px;
      transition: opacity 0.5s ease;
    }

    .overlay-controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 10;
      border-radius: 0;
    }

    .overlay-hidden {
      opacity: 0;
      pointer-events: none;
    }

    label {
      font-size: 14px;
      font-weight: bold;
    }

    button, select, input[type="file"], input[type="range"] {
      background-color: #00e5ff;
      color: #000;
      border: none;
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover, select:hover {
      background-color: #00bcd4;
    }

    input[type="range"] {
      width: 100px;
      accent-color: #00e5ff;
    }

    input[type="file"] {
      background-color: #1e1e1e;
      color: #fff;
      border: 1px solid #00e5ff;
    }

    @media (max-width: 600px) {
      .controls {
        flex-direction: column;
        gap: 5px;
      }

details summary::-webkit-details-marker {
  display: none;
}

details[open] summary::after {
  content: "‚ñ≤";
  float: right;
  margin-right: 10px;
}

details summary::after {
  content: "‚ñº";
  float: right;
  margin-right: 10px;
    }

.dropdown summary {
  list-style: none;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  color: #00e5ff;
  padding: 10px;
  user-select: none;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.dropdown .dropdown-content {
  padding: 10px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 10px;
  animation: fadeIn 0.3s ease-in-out;
}

.dropdown[open] .arrow {
  transform: rotate(180deg);
  transition: transform 0.3s ease;
}

.arrow {
  display: inline-block;
  transition: transform 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scaleY(0.95); }
  to { opacity: 1; transform: scaleY(1); }
}

  </style>
</head>
<body>

  <h1>üé• Pemutar Video Elegan</h1>

 
<div style="text-align:center; margin-bottom: 15px;">
  <input type="file" id="videoFileInput" accept="video/*" multiple>
</div>

<div style="text-align:center; margin: 15px 0;">
  <button onclick="playPrevious()">‚èÆÔ∏è Sebelumnya</button>
  <button onclick="playNext()">‚è≠Ô∏è Berikutnya</button>
</div>

<ul id="playlist" style="max-width: 900px; margin: auto; list-style: none; padding: 0; color: #00e5ff;"></ul>





  <div class="video-container" id="videoContainer">
    <video id="videoPlayer" controls crossorigin="anonymous">
      <track id="subtitleTrack" kind="subtitles" label="Subtitle" srclang="id" default>
      <track id="chapterTrack" kind="chapters" srclang="id">
    </video>


<div class="controls overlay-controls overlay-hidden">
  <details id="controlDetails" class="dropdown">
    <summary class="dropdown-toggle">üéõÔ∏è Kontrol Video <span class="arrow">‚ñº</span></summary>

    <div class="dropdown-content">
      <button onclick="playVideo()">‚èµ Play</button>
      <button onclick="pauseVideo()">‚è∏ Pause</button>
      <button onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>

      <label>üîä Volume:</label>
      <input type="range" min="0" max="1" step="0.05" onchange="setVolume(this.value)">

      <label>üì∫ Rasio:</label>
      <select id="aspectRatio" onchange="changeAspectRatio()">
        <option value="">Default</option>
        <option value="aspect-16-9">16:9</option>
        <option value="aspect-4-3">4:3</option>
        <option value="aspect-1-1">1:1</option>
        <option value="aspect-fill">Fill</option>
      </select>

      <label>üéß Audio:</label>
      <select id="audioTrackSelector" onchange="changeAudioTrack()">
        <option value="-1">Default</option>
      </select>

      <label>üìÑ Subtitle:</label>
      <input type="file" accept=".vtt,.srt" id="subtitleFileInput">

      <label>üìå Chapter:</label>
      <input type="file" accept=".vtt" id="chapterFileInput">
      <select id="chapterSelector" onchange="seekToChapter()">
        <option value="">Pilih Chapter</option>
      </select>

      <label>üîà Channel:</label>
      <select id="channelSelector" onchange="changeChannel()">
        <option value="stereo">Stereo</option>
        <option value="left">Left Only</option>
        <option value="right">Right Only</option>
      </select>
    </div>
  </details>
</div>



  <script>
    const videoPlayer = document.getElementById('videoPlayer');
    const videoContainer = document.getElementById('videoContainer');
    const fileInput = document.getElementById('videoFileInput');
    const audioTrackSelector = document.getElementById('audioTrackSelector');
    const subtitleInput = document.getElementById('subtitleFileInput');
    const subtitleTrack = document.getElementById('subtitleTrack');
    const aspectSelect = document.getElementById('aspectRatio');
    const chapterInput = document.getElementById('chapterFileInput');
    const chapterTrack = document.getElementById('chapterTrack');
    const chapterSelector = document.getElementById('chapterSelector');
    const channelSelector = document.getElementById('channelSelector');
    const controls = document.querySelector('.controls');

    let audioContext, sourceNode, splitter, merger;
    let overlayTimeout;

    fileInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        videoPlayer.src = url;
        videoPlayer.load();
        videoPlayer.addEventListener('loadedmetadata', updateAudioTracks);
        setupAudioRouting();
      }
    });

    function playVideo() { videoPlayer.play(); }
    function pauseVideo() { videoPlayer.pause(); }
    function toggleFullscreen() {
  if (videoContainer.requestFullscreen) {
    videoContainer.requestFullscreen().then(() => {
      lockOrientation();
    });
  }
}

function lockOrientation() {
  const screenOrientation = screen.orientation || screen.mozOrientation || screen.msOrientation;
  if (screenOrientation && screenOrientation.lock) {
    screenOrientation.lock('landscape').catch(err => {
      console.warn("Gagal mengunci orientasi:", err);
    });
  }
}

    function setVolume(value) {
      videoPlayer.volume = value;
    }

    function changeAspectRatio() {
      const val = aspectSelect.value;
      videoContainer.className = 'video-container';
      if (val) videoContainer.classList.add(val);
    }

    function updateAudioTracks() {
      const audioTracks = videoPlayer.audioTracks;
      audioTrackSelector.innerHTML = '<option value="-1">Default</option>';
      if (audioTracks) {
        for (let i = 0; i < audioTracks.length; i++) {
          const label = audioTracks[i].label || `Track ${i + 1}`;
          const option = document.createElement('option');
          option.value = i;
          option.textContent = label;
          audioTrackSelector.appendChild(option);
        }
      }
    }

    function changeAudioTrack() {
      const idx = parseInt(audioTrackSelector.value);
      const tracks = videoPlayer.audioTracks;
      if (!tracks) return;
      for (let i = 0; i < tracks.length; i++) {
        tracks[i].enabled = i === idx;
      }
    }

    subtitleInput.addEventListener('change', function () {
      const file = this.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        let text = e.target.result;
        if (file.name.endsWith('.srt')) {
          text = "WEBVTT\n\n" + text
            .replace(/\r+/g, '')
            .replace(/(\d+)\n(\d{2}:\d{2}:\d{2}),(\d{3}) --> (\d{2}:\d{2}:\d{2}),(\d{3})/g,
              '$1\n$2.$3 --> $4.$5');
        }
        const blob = new Blob([text], { type: 'text/vtt' });
        subtitleTrack.src = URL.createObjectURL(blob);
        subtitleTrack.mode = 'showing';
      };
      reader.readAsText(file);
    });

    chapterInput.addEventListener('change', function () {
      const file = this.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        const text = e.target.result;
        chapterTrack.src = URL.createObjectURL(new Blob([text], { type: 'text/vtt' }));
        chapterTrack.mode = 'showing';
        loadChapters(text);
      };
      reader.readAsText(file);
    });

    function loadChapters(text) {
      const lines = text.split('\n');
      const chapters = [];
      for (let i = 0; i < lines.length; i++) {
        if (lines[i].includes('-->')) {
          const time = lines[i].split('-->')[0].trim();
          const label = lines[i + 1]?.trim() || 'Chapter';
          chapters.push({ time: timeToSeconds(time), label });
        }
      }
      chapterSelector.innerHTML = '<option value="">Pilih Chapter</option>';
      chapters.forEach(ch => {
        const opt = document.createElement('option');
        opt.value = ch.time;
        opt.textContent = ch.label;
        chapterSelector.appendChild(opt);
      });
    }

    function seekToChapter() {
      const time = parseFloat(chapterSelector.value);
      if (!isNaN(time)) {
        videoPlayer.currentTime = time;
        videoPlayer.play();
      }
    }

    function timeToSeconds(t) {
      const [h, m, s] = t.split(':');
      return (+h) * 3600 + (+m) * 60 + parseFloat(s);
    }

    function setupAudioRouting() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        sourceNode = audioContext.createMediaElementSource(videoPlayer);
        splitter = audioContext.createChannelSplitter(2);
        merger = audioContext.createChannelMerger(2);
        sourceNode.connect(splitter);
        splitter.connect(merger, 0, 0);
        splitter.connect(merger, 1, 1);
        merger.connect(audioContext.destination);
      }
    }

    function changeChannel() {
      if (!audioContext) return;
      const mode = channelSelector.value;
      splitter.disconnect();
      merger.disconnect();

      if (mode === 'left') {
        splitter.connect(merger, 0, 0);
        splitter.connect(merger, 0, 1);
      } else if (mode === 'right') {
        splitter.connect(merger, 1, 0);
        splitter.connect(merger, 1, 1);
      } else {
        splitter.connect(merger, 0, 0);
        splitter.connect(merger, 1, 1);
      }

      merger.connect(audioContext.destination);
    }

    function updateOrientation() {
      const isLandscape = window.innerWidth > window.innerHeight;
      if (isLandscape) {
        controls.classList.add('overlay-controls');
        showOverlayControls();
      } else {
        controls.classList.remove('overlay-controls');
        controls.classList.remove('overlay-hidden');
        if (overlayTimeout) clearTimeout(overlayTimeout);
      }
    }

    function showOverlayControls() {
      controls.classList.remove('overlay-hidden');
      if (overlayTimeout) clearTimeout(overlayTimeout);
      if (window.innerWidth > window.innerHeight) {
        overlayTimeout = setTimeout(() => {
          controls.classList.add('overlay-hidden');
        }, 3000);
      }
    }

    function setupOverlayAutoHide() {
      ['mousemove', 'touchstart'].forEach(event => {
        document.addEventListener(event, showOverlayControls);
      });
    }

    window.addEventListener('resize', updateOrientation);
    window.addEventListener('orientationchange', updateOrientation);
    document.addEventListener('DOMContentLoaded', () => {
      updateOrientation();
      setupOverlayAutoHide();
    });

const playlist = [];
const playlistElement = document.getElementById('playlist');

fileInput.addEventListener('change', function () {
  const files = Array.from(this.files);
  playlist.length = 0;
  playlistElement.innerHTML = '';

  files.forEach((file, index) => {
    const url = URL.createObjectURL(file);
    playlist.push({ file, url });

    const li = document.createElement('li');
    li.textContent = file.name;
    li.style.cursor = 'pointer';
    li.style.padding = '6px 12px';
    li.style.borderBottom = '1px solid #00e5ff';
    li.addEventListener('click', () => playFromPlaylist(index));
    playlistElement.appendChild(li);
  });

  if (playlist.length > 0) {
    playFromPlaylist(0);
  }
});

function playFromPlaylist(index) {
  const item = playlist[index];
  if (item) {
    videoPlayer.src = item.url;
    videoPlayer.load();
    videoPlayer.play();
  }
}


let currentIndex = 0;

function playFromPlaylist(index) {
  const item = playlist[index];
  if (item) {
    currentIndex = index;
    videoPlayer.src = item.url;
    videoPlayer.load();
    videoPlayer.play();
    highlightCurrent(index);
    savePlaylistToStorage();
  }
}

function playNext() {
  if (currentIndex < playlist.length - 1) {
    playFromPlaylist(currentIndex + 1);
  }
}

function playPrevious() {
  if (currentIndex > 0) {
    playFromPlaylist(currentIndex - 1);
  }
}

function highlightCurrent(index) {
  const items = playlistElement.querySelectorAll('li');
  items.forEach((li, i) => {
    li.style.background = i === index ? '#00e5ff' : 'transparent';
    li.style.color = i === index ? '#000' : '#00e5ff';
  });
}

function savePlaylistToStorage() {
  const names = playlist.map(p => p.file.name);
  localStorage.setItem('playlistNames', JSON.stringify(names));
}

function restorePlaylist() {
  const saved = JSON.parse(localStorage.getItem('playlistNames') || '[]');
  if (saved.length > 0) {
    playlistElement.innerHTML = '';
    saved.forEach(name => {
      const li = document.createElement('li');
      li.textContent = name + ' (reselect file to play)';
      li.style.color = '#777';
      li.style.cursor = 'not-allowed';
      playlistElement.appendChild(li);
    });
  }
}

// Muat ulang playlist saat halaman dimuat ulang
document.addEventListener('DOMContentLoaded', () => {
  updateOrientation();
  setupOverlayAutoHide();
  restorePlaylist();
});

  </script>
</body>
</html>